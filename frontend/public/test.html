<!DOCTYPE html>
<html>
<head>
    <title>MyBlog Test</title>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const PostList = ({ posts, deletePost }) => {
          return (
            <div className="post-list">
              <h2>Blog Posts</h2>
              {posts.length === 0 ? (
                <p>No posts yet. Be the first to create one!</p>
              ) : (
                posts.map(post => (
                  <div key={post._id} className="post-item">
                    <h3>{post.title}</h3>
                    <p>{post.content}</p>
                    <small>Created: {new Date(post.createdAt).toLocaleDateString()}</small>
                    <button onClick={() => deletePost(post._id)}>Delete</button>
                  </div>
                ))
              )}
            </div>
          );
        };

        const PostForm = ({ addPost }) => {
          const [title, setTitle] = React.useState('');
          const [content, setContent] = React.useState('');

          const handleSubmit = (e) => {
            e.preventDefault();
            if (title && content) {
              addPost({ title, content });
              setTitle('');
              setContent('');
            }
          };

          return (
            <div className="post-form">
              <h2>Create New Post</h2>
              <form onSubmit={handleSubmit}>
                <div>
                  <label htmlFor="title">Title:</label>
                  <input
                    type="text"
                    id="title"
                    value={title}
                    onChange={(e) => setTitle(e.target.value)}
                    required
                  />
                </div>
                <div>
                  <label htmlFor="content">Content:</label>
                  <textarea
                    id="content"
                    value={content}
                    onChange={(e) => setContent(e.target.value)}
                    required
                  ></textarea>
                </div>
                <button type="submit">Create Post</button>
              </form>
            </div>
          );
        };

        const App = () => {
          const [posts, setPosts] = React.useState([]);
          const [loading, setLoading] = React.useState(true);
          const [error, setError] = React.useState('');

          // Fetch all posts
          const fetchPosts = async () => {
            try {
              const response = await fetch('/api/posts');
              const data = await response.json();
              setPosts(data);
              setLoading(false);
            } catch (err) {
              setError('Error fetching posts');
              setLoading(false);
            }
          };

          // Add a new post
          const addPost = async (post) => {
            try {
              const response = await fetch('/api/posts', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(post),
              });
              const data = await response.json();
              setPosts([data, ...posts]);
            } catch (err) {
              setError('Error adding post');
            }
          };

          // Delete a post
          const deletePost = async (id) => {
            try {
              await fetch(`/api/posts/${id}`, {
                method: 'DELETE',
              });
              setPosts(posts.filter(post => post._id !== id));
            } catch (err) {
              setError('Error deleting post');
            }
          };

          React.useEffect(() => {
            fetchPosts();
          }, []);

          if (loading) return React.createElement('div', null, 'Loading...');
          if (error) return React.createElement('div', null, 'Error: ', error);

          return React.createElement(
            'div',
            { className: 'App' },
            React.createElement(
              'header',
              { className: 'App-header' },
              React.createElement('h1', null, 'MyBlog'),
              React.createElement('p', null, 'Welcome to my blog application built with the MERN stack!')
            ),
            React.createElement(
              'main',
              null,
              React.createElement(PostForm, { addPost: addPost }),
              React.createElement(PostList, { posts: posts, deletePost: deletePost })
            )
          );
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>